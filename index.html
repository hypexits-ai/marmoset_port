<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marm0SET_toolBAG | Portfolio</title>
    <link href="https://unpkg.com" rel="stylesheet">
    <style>
        :root { 
            --bg: #0a0a0a; --text: #f5f5f5; --gray-light: rgba(20, 20, 25, 0.6); 
            --line: rgba(255,255,255,0.05); --accent: #fff; --border-glass: rgba(255, 255, 255, 0.3);
            --glow: rgba(255, 255, 255, 0.5); --transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        [data-theme="light"] {
            --bg: #ffffff; --text: #1a1a1a; --gray-light: rgba(255, 255, 255, 0.4); 
            --accent: #000; --line: rgba(0,0,0,0.05); --border-glass: rgba(0, 0, 0, 0.1); 
            --glow: rgba(0, 0, 0, 0.2);
        }

        html, body { max-width: 100%; overflow-x: hidden; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: background 0.5s; user-select: none; -webkit-user-select: none; }
        
        #gradient-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        #progress-bar { position: fixed; top: 0; left: 0; height: 3px; background: var(--accent); width: 0%; z-index: 1000; }

        nav { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--gray-light); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); z-index: 100; border-bottom: 1px solid var(--line); box-sizing: border-box; }
        .logo { font-weight: 800; font-size: 0.75rem; text-transform: uppercase; }
        .nav-controls { display: flex; gap: 6px; align-items: center; }
        .btn-ui { cursor: pointer; background: var(--gray-light); border: 1px solid var(--line); color: var(--text); padding: 6px 10px; border-radius: 20px; font-size: 9px; font-weight: 700; text-decoration: none; border-style: solid; }

        .site-version { position: fixed; bottom: 15px; right: 15px; padding: 5px 12px; border-radius: 10px; font-size: 10px; font-weight: 800; background: var(--gray-light); backdrop-filter: blur(10px); border: 1px solid var(--border-glass); opacity: 0.6; z-index: 999; }

        header { padding: 50px 20px 20px; max-width: 1000px; margin: 0 auto; text-align: center; }
        header h1 { font-size: 2rem; margin: 0; font-weight: 800; line-height: 1.2; text-transform: uppercase; letter-spacing: -1px; }

        .about-section, .contact-section, .card {
            background: var(--gray-light) !important;
            backdrop-filter: blur(25px) saturate(160%);
            -webkit-backdrop-filter: blur(25px) saturate(160%);
            border: 1px solid var(--border-glass) !important;
            border-top: 1px solid rgba(255,255,255,0.2) !important;
            border-radius: 30px;
        }

        .card { width: 100%; max-width: 550px; overflow: hidden; position: relative; margin: 0 auto; transition: border-color 0.3s, box-shadow 0.3s; }
        .card:hover { border-color: var(--glow) !important; box-shadow: 0 0 25px var(--glow); }

        .gallery { display: grid; grid-template-columns: 1fr; gap: 30px; padding: 20px; justify-items: center; width: 100%; box-sizing: border-box; }
        
        @media (min-width: 768px) { 
            nav { padding: 15px 50px; }
            .logo { font-size: 0.9rem; }
            header h1 { font-size: 3.5rem; text-align: left; } 
            .gallery { grid-template-columns: repeat(2, 1fr); padding: 50px; gap: 60px; max-width: 1400px; margin: 0 auto; }
        }

        @keyframes skeleton-pulse {
            0% { background-color: var(--gray-light); }
            50% { background-color: var(--line); }
            100% { background-color: var(--gray-light); }
        }

        .slider-viewport { position: relative; height: 350px; width: 100%; overflow: hidden; touch-action: pan-y; cursor: zoom-in; background: var(--bg); }
        @media (min-width: 768px) { .slider-viewport { height: 500px; } }

        .slide { position: absolute; inset: 0; opacity: 0; transform: scale(1.02); transition: opacity 0.6s ease, transform 0.6s ease; pointer-events: none; }
        .slide::before { content: ""; position: absolute; inset: 0; animation: skeleton-pulse 1.8s infinite; z-index: -1; }
        .slide.active { opacity: 1; transform: scale(1); z-index: 5; pointer-events: auto; }
        
        .slide img { width: 100%; height: 100%; object-fit: contain; background: var(--bg); display: block; -webkit-user-drag: none; opacity: 0; transition: opacity 0.5s ease; }
        .slide img.loaded { opacity: 1; }

        .nav-arrow { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.4); color: white; border: none; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; z-index: 20; opacity: 0; transition: opacity 0.3s, background 0.3s; display: none; backdrop-filter: blur(5px); }
        @media (hover: hover) { 
            .slider-viewport:hover .nav-arrow { opacity: 1; } 
            .nav-arrow { display: flex; align-items: center; justify-content: center; font-size: 18px; }
            .nav-arrow:hover { background: rgba(0,0,0,0.8); }
        }
        .arrow-left { left: 15px; }
        .arrow-right { right: 15px; }

        .dots { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 4px; z-index: 10; flex-wrap: wrap; justify-content: center; width: 80%; pointer-events: none; }
        .dot { width: 5px; height: 5px; background: rgba(128,128,128,0.4); border-radius: 50%; border: 1px solid var(--border-glass); transition: 0.3s; }
        .dot.active { background: var(--accent); width: 12px; border-radius: 3px; }

        #lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; z-index: 2000; align-items: center; justify-content: center; touch-action: none; }
        #lightbox img { max-width: 95%; max-height: 92%; object-fit: contain; border: 1px solid var(--border-glass); border-radius: 12px; transition: opacity 0.3s ease; opacity: 0; }

        footer { padding: 60px 40px; text-align: center; color: #888; font-size: 11px; letter-spacing: 1px; }
    </style>
</head>
<body data-theme="dark">

<canvas id="gradient-canvas"></canvas>
<div id="progress-bar"></div>
<div id="lightbox" onclick="closeLB(event)"><img id="lb-img" src=""></div>
<div class="site-version">v1.6.1</div>

<nav>
    <div class="logo">Marm0SET_toolBAG</div>
    <div class="nav-controls">
        <button class="btn-ui" onclick="toggleLang()" id="lang-btn">EN</button>
        <button class="btn-ui" onclick="toggleTheme()" id="theme-btn">LIGHT</button>
        <a href="#contact" class="btn-ui" data-tr="nav_contact">–ö–û–ù–¢–ê–ö–¢–´</a>
    </div>
</nav>

<header data-aos="fade-up">
    <h1 data-tr="header_title">–ë–µ—Å–∫–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º</h1>
</header>

<section class="about-section" data-aos="fade-up" style="padding: 30px; max-width: 1100px; margin: 20px auto; width: 90%; box-sizing: border-box;">
    <p id="about-text" style="font-size: 1rem; opacity: 0.8; line-height: 1.6; margin: 0;"></p>
</section>

<main class="gallery" id="portfolio-grid"></main>

<section class="contact-section" id="contact" data-aos="fade-up" style="margin: 40px auto; padding: 50px 20px; max-width: 1100px; text-align: center; width: 90%; box-sizing: border-box;">
    <h2 data-tr="contact_title" style="margin-top: 0;">–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π</h2>
    <div style="font-weight: 600; line-height: 2.8; font-size: 0.95rem;">
        <a href="https://kwork.ru" target="_blank" style="color:var(--text); text-decoration:none;">üíº Kwork Profile</a><br>
        <span onclick="copyToClipboard('hypexits@mail.ru')" style="cursor:pointer;">üìß hypexits@mail.ru</span><br>
        <span onclick="copyToClipboard('@WINDUP_MARMOSET')" style="cursor:pointer;">‚úàÔ∏è @WINDUP_MARMOSET</span><br>
        <span onclick="copyToClipboard('+79251803895')" style="cursor:pointer;">üìû +7 (925) 180-38-95</span>
    </div>
</section>

<footer>¬© 2024 MARMOSET_TOOLBAG ‚Ä¢ 3D ARTIST PORTFOLIO</footer>

<script src="https://unpkg.com"></script>
<script>
    const canvas = document.getElementById('gradient-canvas');
    const ctx = canvas.getContext('2d');
    let time = 0;
    function animate() {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        const isLight = document.body.getAttribute('data-theme') === 'light';
        const c1 = isLight ? {r:240,g:245,b:255} : {r:15,g:10,b:35};
        const c2 = isLight ? {r:225,g:230,b:245} : {r:40,g:20,b:80};
        const grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
        const shift = Math.sin(time) * 0.5 + 0.5;
        grad.addColorStop(0, `rgb(${c1.r},${c1.g},${c1.b})`);
        grad.addColorStop(shift, `rgb(${c2.r},${c2.g},${c2.b})`);
        grad.addColorStop(1, `rgb(${c1.r},${c1.g},${c1.b})`);
        ctx.fillStyle = grad; ctx.fillRect(0,0,canvas.width,canvas.height);
        time += 0.007; requestAnimationFrame(animate);
    }
    animate();

    const translations = {
        ru: { nav_contact: "–ö–û–ù–¢–ê–ö–¢–´", header_title: "–ë–µ—Å–∫–æ–º–ø—Ä–æ–º–∏—Å—Å–Ω—ã–π —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º", about_text: "–ò—â–µ—Ç–µ –æ–ø—ã—Ç–Ω–æ–≥–æ 3D —Ö—É–¥–æ–∂–Ω–∏–∫–∞? –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é, –∏–≥—Ä–æ–≤—ã–µ –∞—Å—Å–µ—Ç–æ–≤ –∏ –∞–Ω–∏–º–∞—Ü–∏—é. –í–ª–∞–¥–µ—é Blender, Substance, UE5.", contact_title: "–°–≤—è–∑–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π" },
        en: { nav_contact: "CONTACT", header_title: "Uncompromising Photorealism", about_text: "Looking for an experienced 3D artist? I offer visualization, game assets and animation. Skilled in Blender, Substance, UE5.", contact_title: "Get in Touch" }
    };

    let currentLang = 'ru';
    let myWorks = [];

    async function discoverWorks() {
        let pId = 1;
        let pFound = true;
        while(pFound && pId < 50) {
            const firstImg = `images/p${pId}_1.webp`;
            try {
                const res = await fetch(firstImg, { method: 'HEAD' });
                if (res.ok) {
                    let images = [];
                    let imgId = 1;
                    let imgFound = true;
                    while(imgFound && imgId < 20) {
                        const path = `images/p${pId}_${imgId}.webp`;
                        const imgRes = await fetch(path, { method: 'HEAD' });
                        if(imgRes.ok) { images.push(path); imgId++; } else { imgFound = false; }
                    }
                    myWorks.push({ id: pId, images: images });
                    pId++;
                } else { pFound = false; }
            } catch (e) { pFound = false; }
        }
        updateUI();
    }

    function toggleLang() { currentLang = currentLang === 'ru' ? 'en' : 'ru'; updateUI(); }
    function updateUI() {
        const tr = translations[currentLang];
        document.querySelectorAll('[data-tr]').forEach(el => {
            if(tr[el.getAttribute('data-tr')]) el.innerHTML = tr[el.getAttribute('data-tr')];
        });
        document.getElementById('about-text').innerText = tr.about_text;
        document.getElementById('lang-btn').innerText = currentLang.toUpperCase();
        renderGallery();
    }

    function createCard(work, i) {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('data-aos', window.innerWidth < 768 ? 'fade-up' : (i % 2 === 0 ? 'fade-right' : 'fade-left'));
        
        let s = ''; let d = '';
        work.images.forEach((imgUrl, idx) => {
            const loading = (i < 2 && idx === 0) ? 'eager' : 'lazy';
            s += `<div class="slide ${idx === 0 ? 'active' : ''}" onclick="openLB(${i}, ${idx})">
                    <img src="${imgUrl}" loading="${loading}" onload="this.classList.add('loaded')">
                  </div>`;
            d += `<div class="dot ${idx === 0 ? 'active' : ''}"></div>`;
        });
        
        const title = (work.id === 11) ? "Cinematic" : "CGI Project #" + work.id;
        card.innerHTML = `
            <div class="slider-viewport">
                <button class="nav-arrow arrow-left" onclick="changeSlide(this, -1, event)">‚ùÆ</button>
                <button class="nav-arrow arrow-right" onclick="changeSlide(this, 1, event)">‚ùØ</button>
                ${s}<div class="dots">${d}</div>
            </div>
            <div style="padding:20px"><h3>${title}</h3><p style="font-size:11px;opacity:0.5;text-transform:uppercase;letter-spacing:1px">Production</p></div>`;
        
        const vp = card.querySelector('.slider-viewport');
        if (work.images.length > 1) {
            let startX = 0;
            vp.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, {passive: true});
            vp.addEventListener('touchend', (e) => {
                let diff = startX - e.changedTouches[0].clientX;
                if (Math.abs(diff) > 40) manualChange(vp, diff > 0 ? 1 : -1);
            }, {passive: true});
        }
        return card;
    }

    function manualChange(vp, dir) {
        const slides = vp.querySelectorAll('.slide');
        const dots = vp.querySelectorAll('.dot');
        let curr = Array.from(slides).findIndex(el => el.classList.contains('active'));
        if (curr === -1) return;
        slides[curr].classList.remove('active'); dots[curr].classList.remove('active');
        curr = (curr + dir + slides.length) % slides.length;
        slides[curr].classList.add('active'); dots[curr].classList.add('active');
    }

    function changeSlide(btn, dir, event) { event.stopPropagation(); manualChange(btn.parentElement, dir); }

    function renderGallery() {
        const grid = document.getElementById('portfolio-grid'); 
        grid.innerHTML = '';
        myWorks.forEach((w, i) => grid.appendChild(createCard(w, i)));
        if(typeof AOS !== 'undefined') AOS.refresh();
    }

    let currentWorkIdx = 0; let currentImgIdx = 0;
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lb-img');
    let lbStartX = 0, lbStartY = 0;

    function openLB(wIdx, iIdx) {
        currentWorkIdx = wIdx; currentImgIdx = iIdx;
        updateLBImage();
        lb.style.display = 'flex';
    }

    function updateLBImage() {
        lbImg.style.opacity = '0';
        const targetSrc = myWorks[currentWorkIdx].images[currentImgIdx];
        const temp = new Image();
        temp.src = targetSrc;
        temp.onload = () => { lbImg.src = targetSrc; lbImg.style.opacity = '1'; };
    }

    function closeLB(e) { if (e.target.id === 'lightbox' || e.target.id === 'lb-img') lb.style.display = 'none'; }

    lb.addEventListener('touchstart', (e) => { lbStartX = e.touches[0].clientX; lbStartY = e.touches[0].clientY; }, {passive: true});
    lb.addEventListener('touchend', (e) => {
        let diffX = lbStartX - e.changedTouches[0].clientX;
        let diffY = lbStartY - e.changedTouches[0].clientY;
        const threshold = 50;
        if (Math.abs(diffX) > Math.abs(diffY)) {
            if (Math.abs(diffX) > threshold) {
                const imgs = myWorks[currentWorkIdx].images;
                currentImgIdx = (currentImgIdx + (diffX > 0 ? 1 : -1) + imgs.length) % imgs.length;
                updateLBImage();
            }
        } else {
            if (diffY > threshold) {
                currentWorkIdx = (currentWorkIdx + 1) % myWorks.length;
                currentImgIdx = 0; updateLBImage();
            } else if (diffY < -threshold) {
                currentWorkIdx = (currentWorkIdx - 1 + myWorks.length) % myWorks.length;
                currentImgIdx = 0; updateLBImage();
            }
        }
    }, {passive: true});

    function toggleTheme() { 
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('theme-btn').innerText = isDark ? 'DARK' : 'LIGHT';
    }

    function copyToClipboard(t) { navigator.clipboard.writeText(t); alert('Copied: ' + t); }
    window.onscroll = () => { 
        const h = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        if (h > 0) document.getElementById("progress-bar").style.width = (window.scrollY / h) * 100 + "%"; 
    };

    document.addEventListener('DOMContentLoaded', () => { discoverWorks(); if(typeof AOS !== 'undefined') AOS.init({ duration: 800, once: true }); });
</script>
</body>
</html>
